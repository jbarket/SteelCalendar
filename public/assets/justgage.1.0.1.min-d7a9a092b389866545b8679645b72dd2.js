/**
 * JustGage - a handy JavaScript plugin for generating and animating nice & clean dashboard gauges.
 * Copyright (c) 2012 Bojan Djuricic - pindjur(at)gmail(dot)com | http://www.madcog.com
 * Licensed under MIT.
 * Date: 31/07/2012
 * @author Bojan Djuricic  (@Toorshia)
 * @version 1.0
 *
 * http://www.justgage.com
 */
function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function cutHex(t){return"#"==t.charAt(0)?t.substring(1,7):t}function getStyle(t,e){var i="";return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,"").getPropertyValue(e):t.currentStyle&&(e=e.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),i=t.currentStyle[e]),i}function onCreateElementNsReady(t){void 0!=document.createElementNS?t():setTimeout(function(){onCreateElementNsReady(t)},100)}JustGage=function(t){if(!t.id)return alert("Missing id parameter for gauge!"),!1;if(!document.getElementById(t.id))return alert('No element with id: "'+t.id+'" found!'),!1;this.config={id:t.id,title:t.title?t.title:"Title",titleFontColor:t.titleFontColor?t.titleFontColor:"#999999",value:t.value?t.value:0,valueFontColor:t.valueFontColor?t.valueFontColor:"#010101",min:t.min?t.min:0,max:t.max?t.max:100,showMinMax:null!=t.showMinMax?t.showMinMax:!0,gaugeWidthScale:t.gaugeWidthScale?t.gaugeWidthScale:1,gaugeColor:t.gaugeColor?t.gaugeColor:"#edebeb",label:t.label?t.label:"",showInnerShadow:null!=t.showInnerShadow?t.showInnerShadow:!0,shadowOpacity:t.shadowOpacity?t.shadowOpacity:.2,shadowSize:t.shadowSize?t.shadowSize:5,shadowVerticalOffset:t.shadowVerticalOffset?t.shadowVerticalOffset:3,levelColors:t.levelColors?t.levelColors:percentColors,levelColorsGradient:null!=t.levelColorsGradient?t.levelColorsGradient:!0,labelFontColor:t.labelFontColor?t.labelFontColor:"#b3b3b3",startAnimationTime:t.startAnimationTime?t.startAnimationTime:700,startAnimationType:t.startAnimationType?t.startAnimationType:">",refreshAnimationTime:t.refreshAnimationTime?t.refreshAnimationTime:700,refreshAnimationType:t.refreshAnimationType?t.refreshAnimationType:">"},t.value>this.config.max&&(this.config.value=this.config.max),t.value<this.config.min&&(this.config.value=this.config.min),this.originalValue=t.value,this.canvas=Raphael(this.config.id,"100%","100%");var e,i,n=1*getStyle(document.getElementById(this.config.id),"width").slice(0,-2),s=1*getStyle(document.getElementById(this.config.id),"height").slice(0,-2);n/s>1.25?(e=1.25*s,i=s):(e=n,i=n/1.25);var a=(n-e)/2,o=(s-i)/2,r=i/8>10?i/10:10,l=a+e/2,h=o+i/6.5,c=i/6.4>16?i/6.4:16,u=a+e/2,d=o+i/1.4,p=i/16>10?i/16:10,f=a+e/2,g=d+c/2+6,m=i/16>10?i/16:10,v=a+e/10+e/6.666666666666667*this.config.gaugeWidthScale/2,y=o+i/1.126760563380282,b=i/16>10?i/16:10,x=a+e-e/10-e/6.666666666666667*this.config.gaugeWidthScale/2,_=o+i/1.126760563380282;this.params={canvasW:n,canvasH:s,widgetW:e,widgetH:i,dx:a,dy:o,titleFontSize:r,titleX:l,titleY:h,valueFontSize:c,valueX:u,valueY:d,labelFontSize:p,labelX:f,labelY:g,minFontSize:m,minX:v,minY:y,maxFontSize:b,maxX:x,maxY:_},this.canvas.customAttributes.pki=function(t,e,i,n,s,a,o,r){var l,h=(1-(t-e)/(i-e))*Math.PI,c=n/2-n/10,u=c-n/6.666666666666667*r,d=n/2+a,p=s/1.25+o,f=n/2+a+c*Math.cos(h),g=s-(s-p)+o-c*Math.sin(h),m=n/2+a+u*Math.cos(h),v=s-(s-p)+o-u*Math.sin(h);return l+="M"+(d-u)+","+p+" ",l+="L"+(d-c)+","+p+" ",l+="A"+c+","+c+" 0 0,1 "+f+","+g+" ",l+="L"+m+","+v+" ",l+="A"+u+","+u+" 0 0,0 "+(d-u)+","+p+" ",l+="z ",{path:l}},this.gauge=this.canvas.path().attr({stroke:"none",fill:this.config.gaugeColor,pki:[this.config.max,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]}),this.gauge.id=this.config.id+"-gauge",this.level=this.canvas.path().attr({stroke:"none",fill:getColorForPercentage((this.config.value-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient),pki:[this.config.min,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]}),this.level.id=this.config.id+"-level",this.txtTitle=this.canvas.text(this.params.titleX,this.params.titleY,this.config.title),this.txtTitle.attr({"font-size":this.params.titleFontSize,"font-weight":"bold","font-family":"Arial",fill:this.config.titleFontColor,"fill-opacity":"1"}),this.txtTitle.id=this.config.id+"-txttitle",this.txtValue=this.canvas.text(this.params.valueX,this.params.valueY,this.originalValue),this.txtValue.attr({"font-size":this.params.valueFontSize,"font-weight":"bold","font-family":"Arial",fill:this.config.valueFontColor,"fill-opacity":"0"}),this.txtValue.id=this.config.id+"-txtvalue",this.txtLabel=this.canvas.text(this.params.labelX,this.params.labelY,this.config.label),this.txtLabel.attr({"font-size":this.params.labelFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":"0"}),this.txtLabel.id=this.config.id+"-txtlabel",this.txtMin=this.canvas.text(this.params.minX,this.params.minY,this.config.min),this.txtMin.attr({"font-size":this.params.minFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":1==this.config.showMinMax?"1":"0"}),this.txtMin.id=this.config.id+"-txtmin",this.txtMax=this.canvas.text(this.params.maxX,this.params.maxY,this.config.max),this.txtMax.attr({"font-size":this.params.maxFontSize,"font-weight":"normal","font-family":"Arial",fill:this.config.labelFontColor,"fill-opacity":1==this.config.showMinMax?"1":"0"}),this.txtMax.id=this.config.id+"-txtmax";var w=this.canvas.canvas.childNodes[1],C="http://www.w3.org/2000/svg";9>ie?onCreateElementNsReady(function(){this.generateShadow()}):this.generateShadow(C,w),this.level.animate({pki:[this.config.value,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]},this.config.startAnimationTime,this.config.startAnimationType),this.txtValue.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType),this.txtLabel.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType)},JustGage.prototype.refresh=function(t){originalVal=t,t>this.config.max&&(t=this.config.max),t<this.config.min&&(t=this.config.min);var e=getColorForPercentage((t-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient);this.canvas.getById(this.config.id+"-txtvalue").attr({text:originalVal}),this.canvas.getById(this.config.id+"-level").animate({pki:[t,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale],fill:e},this.config.refreshAnimationTime,this.config.refreshAnimationType)};var percentColors=["#a9d70b","#f9c802","#ff0000"];JustGage.prototype.generateShadow=function(t,e){var i=document.createElementNS(t,"filter");i.setAttribute("id",this.config.id+"-inner-shadow"),e.appendChild(i);var n=document.createElementNS(t,"feOffset");n.setAttribute("dx",0),n.setAttribute("dy",this.config.shadowVerticalOffset),i.appendChild(n);var s=document.createElementNS(t,"feGaussianBlur");s.setAttribute("result","offset-blur"),s.setAttribute("stdDeviation",this.config.shadowSize),i.appendChild(s);var a=document.createElementNS(t,"feComposite");a.setAttribute("operator","out"),a.setAttribute("in","SourceGraphic"),a.setAttribute("in2","offset-blur"),a.setAttribute("result","inverse"),i.appendChild(a);var o=document.createElementNS(t,"feFlood");o.setAttribute("flood-color","black"),o.setAttribute("flood-opacity",this.config.shadowOpacity),o.setAttribute("result","color"),i.appendChild(o);var r=document.createElementNS(t,"feComposite");r.setAttribute("operator","in"),r.setAttribute("in","color"),r.setAttribute("in2","inverse"),r.setAttribute("result","shadow"),i.appendChild(r);var l=document.createElementNS(t,"feComposite");l.setAttribute("operator","over"),l.setAttribute("in","shadow"),l.setAttribute("in2","SourceGraphic"),i.appendChild(l),1==this.config.showInnerShadow&&(this.canvas.canvas.childNodes[2].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)"),this.canvas.canvas.childNodes[3].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)"))};var getColorForPercentage=function(t,e,i){var n=e.length;if(1===n)return e[0];for(var s=i?1/(n-1):1/n,a=new Array,o=0;o<e.length;o++){var r=i?s*o:s*(o+1),l=parseInt(cutHex(e[o]).substring(0,2),16),h=parseInt(cutHex(e[o]).substring(2,4),16),c=parseInt(cutHex(e[o]).substring(4,6),16);a[o]={pct:r,color:{r:l,g:h,b:c}}}if(0==t)return"rgb("+[a[0].color.r,a[0].color.g,a[0].color.b].join(",")+")";for(var o=0;o<a.length;o++)if(t<=a[o].pct){if(1==i){var u=a[o-1],d=a[o],p=d.pct-u.pct,f=(t-u.pct)/p,g=1-f,m=f,v={r:Math.floor(u.color.r*g+d.color.r*m),g:Math.floor(u.color.g*g+d.color.g*m),b:Math.floor(u.color.b*g+d.color.b*m)};return"rgb("+[v.r,v.g,v.b].join(",")+")"}return"rgb("+[a[o].color.r,a[o].color.g,a[o].color.b].join(",")+")"}},ie=function(){for(var t,e=3,i=document.createElement("div"),n=i.getElementsByTagName("i");i.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",n[0];);return e>4?e:t}();