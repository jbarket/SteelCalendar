/**
 * Knob - jQuery Plugin
 * Downward compatible, touchable dial
 *
 * Version: 1.1.2 (22/05/2012)
 * Requires: jQuery v1.7+
 *
 * Copyright (c) 2011 Anthony Terrien
 * Under MIT and GPL licenses:
 *  http://www.opensource.org/licenses/mit-license.php
 *  http://www.gnu.org/licenses/gpl.html
 *
 * Thanks to vor, eskimoblood, spiffistan
 */
$(function(){function e(e){return $.isNumeric(e)?e*Math.PI/180:0}var t=function(e,i){var n,s,a,o,r=null,l=e[0].getContext("2d"),c=2*Math.PI,h=this;this.onChange=function(){},this.onCancel=function(){},this.onRelease=function(){},this.val=function(e){if(null==e){var t,l;return t=l=Math.atan2(n-a,-(s-o-i.width/2))-i.angleOffset,0>l&&(t=l+c),e=Math.round(t*(i.max-i.min)/c)+i.min,e>i.max?i.max:e}i.stopper&&(e=Math.max(Math.min(e,i.max),i.min)),r=e,this.onChange(e),i.dynamicDraw?this.dynamicDraw(e):this.draw(e)},this.change=function(e){i.stopper&&(e=Math.max(Math.min(e,i.max),i.min)),this.onChange(e),this.draw(e)},this.angle=function(e){return(e-i.min)*c/(i.max-i.min)},this.draw=function(e){var n,s=this.angle(e),a=1.5*Math.PI+i.angleOffset,o=a,h=a+this.angle(r),u=o+s,d=i.width/2,p=d*i.thickness,f=t.getCgColor(i.cgColor);if(l.clearRect(0,0,i.width,i.width),l.lineWidth=p,!i.draw(s,r,i,l)){for(n=0;n<i.ticks;n++){l.beginPath(),l.strokeStyle=s>2*Math.PI/i.ticks*n&&i.tickColorizeValues?i.fgColor:i.tickColor;var g=2*Math.PI/i.ticks*n-.5*Math.PI;l.arc(d,d,d-p-i.tickLength,g,g+i.tickWidth,!1),l.stroke()}switch(i.cursor&&(a=h-.3)&&(h+=.3)&&(o=u-.3)&&(u+=.3),i.skin){case"default":l.beginPath(),l.strokeStyle=i.bgColor,l.arc(d,d,d-p/2,0,c,!0),l.stroke(),i.displayPrevious&&(l.beginPath(),l.strokeStyle=r==e?i.fgColor:f,l.arc(d,d,d-p/2,a,h,!1),l.stroke()),l.beginPath(),l.strokeStyle=i.fgColor,l.arc(d,d,d-p/2,o,u,!1),l.stroke();break;case"tron":i.displayPrevious&&(l.beginPath(),l.strokeStyle=r==e?i.fgColor:f,l.arc(d,d,d-p,a,h,!1),l.stroke()),l.beginPath(),l.strokeStyle=i.fgColor,l.arc(d,d,d-p,o,u,!1),l.stroke(),l.lineWidth=2,l.beginPath(),l.strokeStyle=i.fgColor,l.arc(d,d,d-p+1+2*p/3,0,2*Math.PI,!1),l.stroke()}}};var u,d;this.dynamicDraw=function(e){var t=this;u=i.min,d=setInterval(function(){t.animateDraw(e)},20)},this.animateDraw=function(){u>r?(clearInterval(d),r=u):(this.draw(u),this.change(u),u++)},this.capture=function(e){switch(e.type){case"mousemove":case"mousedown":n=e.pageX,s=e.pageY;break;case"touchmove":case"touchstart":n=e.originalEvent.touches[0].pageX,s=e.originalEvent.touches[0].pageY}this.change(this.val())},this.cancel=function(){h.val(r),h.onCancel()},this.startDrag=function(t){var n=e.offset(),s=$(document);a=n.left+i.width/2,o=n.top,this.capture(t),s.bind("mousemove.dial touchmove.dial",function(e){h.capture(e)}).bind("keyup.dial",function(e){27===e.keyCode&&(s.unbind("mouseup.dial mousemove.dial keyup.dial"),h.cancel())}).bind("mouseup.dial touchend.dial",function(){s.unbind("mousemove.dial touchmove.dial mouseup.dial touchend.dial keyup.dial"),h.val(h.val()),h.onRelease(r)})}};t.getCgColor=function(e){e=e.substring(1,7);var t=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)];return"rgba("+t[0]+","+t[1]+","+t[2]+",.5)"},$.fn.knob=$.fn.dial=function(i){return this.each(function(){var n,s=$(this);if(s.data("dialed"))return s;s.data("dialed",!0),n=$.extend({min:s.data("min")||0,max:s.data("max")||100,stopper:!0,readOnly:s.data("readonly"),cursor:s.data("cursor"),thickness:s.data("thickness")||.35,width:s.data("width")||200,displayInput:null==s.data("displayinput")||s.data("displayinput"),displayPrevious:s.data("displayprevious"),fgColor:s.data("fgcolor")||"#87CEEB",cgColor:s.data("cgcolor")||s.data("fgcolor")||"#87CEEB",bgColor:s.data("bgcolor")||"#EEEEEE",tickColor:s.data("tickColor")||s.data("fgcolor")||"#DDDDDD",ticks:s.data("ticks")||0,tickLength:s.data("tickLength")||0,tickWidth:s.data("tickWidth")||.02,tickColorizeValues:s.data("tickColorizeValues")||!0,skin:s.data("skin")||"default",angleOffset:e(s.data("angleoffset")),dynamicDraw:s.data("dynamicdraw")||!1,draw:function(){},change:function(){},release:function(){}},i);var a,o=$('<canvas width="'+n.width+'" height="'+n.width+'"></canvas>'),r=$("<div style=width:"+n.width+'px;display:inline;"></div>'),l=s.val(),c=function(){n.displayInput&&s.css({width:n.width/2+"px",position:"absolute","margin-top":5*n.width/14+"px","margin-left":"-"+3*n.width/4+"px","font-size":n.width/4+"px",border:"none",background:"none","font-family":"Arial","font-weight":"bold","text-align":"center",color:n.fgColor,padding:"0px","-webkit-appearance":"none"})||s.css({width:"0px",visibility:"hidden"})};if(s.wrap(r).before(o),c(),a=new t(o,n),l||(l=n.min),s.val(l),a.val(l),a.onRelease=function(e){n.release(e,s)},a.onChange=function(e){s.val(e),n.change(e)},s.bind("change",function(){a.val(s.val())}),n.readOnly)s.attr("readonly","readonly");else{o.bind("mousedown touchstart",function(e){e.preventDefault(),a.startDrag(e)}).bind("mousewheel DOMMouseScroll",mw=function(e){e.preventDefault();var t=e.originalEvent,i=t.detail||t.wheelDeltaX,n=t.detail||t.wheelDeltaY,o=parseInt(s.val())+(i>0||n>0?1:0>i||0>n?-1:0);a.val(o)});var h,u,d=1,p={37:-1,38:1,39:1,40:-1};s.bind("configure",function(e,t){var i;for(i in t)n[i]=t[i];c(),a.val(s.val())}).bind("keydown",function(e){var t=e.keyCode;t>=96&&105>=t&&(t-=48),h=parseInt(String.fromCharCode(t)),isNaN(h)&&(13!==t&&8!==t&&9!==t&&189!==t&&e.preventDefault(),$.inArray(t,[37,38,39,40])>-1&&(a.change(parseInt(s.val())+p[t]*d),u=window.setTimeout(function(){20>d&&d++},50),e.preventDefault()))}).bind("keyup",function(e){isNaN(h)?u?(window.clearTimeout(u),u=null,d=1,a.val(s.val()),a.onRelease(s.val(),s)):13===e.keyCode&&a.onRelease(s.val(),s):s.val()>n.max&&s.val(n.max)||s.val()<n.min&&s.val(n.min)}).bind("mousewheel DOMMouseScroll",mw)}}).parent()}});