/* Pretty handling of time axes.

Copyright (c) 2007-2013 IOLA and Ole Laursen.
Licensed under the MIT license.

Set axis.mode to "time" to enable. See the section "Time series data" in
API.txt for details.

*/
!function(e){function t(e,t){return t*Math.floor(e/t)}function i(e,t,i,n){if("function"==typeof e.strftime)return e.strftime(t);var s=function(e,t){return e=""+e,t=""+(null==t?"0":t),1==e.length?t+e:e},a=[],r=!1,o=e.getHours(),l=12>o;null==i&&(i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==n&&(n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var c;c=o>12?o-12:0==o?12:o;for(var h=0;h<t.length;++h){var u=t.charAt(h);if(r){switch(u){case"a":u=""+n[e.getDay()];break;case"b":u=""+i[e.getMonth()];break;case"d":u=s(e.getDate());break;case"e":u=s(e.getDate()," ");break;case"h":case"H":u=s(o);break;case"I":u=s(c);break;case"l":u=s(c," ");break;case"m":u=s(e.getMonth()+1);break;case"M":u=s(e.getMinutes());break;case"q":u=""+(Math.floor(e.getMonth()/3)+1);break;case"S":u=s(e.getSeconds());break;case"y":u=s(e.getFullYear()%100);break;case"Y":u=""+e.getFullYear();break;case"p":u=l?"am":"pm";break;case"P":u=l?"AM":"PM";break;case"w":u=""+e.getDay()}a.push(u),r=!1}else"%"==u?r=!0:a.push(u)}return a.join("")}function n(e){function t(e,t,i,n){e[t]=function(){return i[n].apply(i,arguments)}}var i={date:e};void 0!=e.strftime&&t(i,"strftime",e,"strftime"),t(i,"getTime",e,"getTime"),t(i,"setTime",e,"setTime");for(var n=["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds"],s=0;s<n.length;s++)t(i,"get"+n[s],e,"getUTC"+n[s]),t(i,"set"+n[s],e,"setUTC"+n[s]);return i}function s(e,t){if("browser"==t.timezone)return new Date(e);if(t.timezone&&"utc"!=t.timezone){if("undefined"!=typeof timezoneJS&&"undefined"!=typeof timezoneJS.Date){var i=new timezoneJS.Date;return i.setTimezone(t.timezone),i.setTime(e),i}return n(new Date(e))}return n(new Date(e))}function a(n){n.hooks.processOptions.push(function(n){e.each(n.getAxes(),function(e,n){var a=n.options;"time"==a.mode&&(n.tickGenerator=function(e){var i=[],n=s(e.min,a),r=0,l=a.tickSize&&"quarter"===a.tickSize[1]||a.minTickSize&&"quarter"===a.minTickSize[1]?h:c;null!=a.minTickSize&&(r="number"==typeof a.tickSize?a.tickSize:a.minTickSize[0]*o[a.minTickSize[1]]);for(var u=0;u<l.length-1&&!(e.delta<(l[u][0]*o[l[u][1]]+l[u+1][0]*o[l[u+1][1]])/2&&l[u][0]*o[l[u][1]]>=r);++u);var d=l[u][0],p=l[u][1];if("year"==p){if(null!=a.minTickSize&&"year"==a.minTickSize[1])d=Math.floor(a.minTickSize[0]);else{var f=Math.pow(10,Math.floor(Math.log(e.delta/o.year)/Math.LN10)),g=e.delta/o.year/f;d=1.5>g?1:3>g?2:7.5>g?5:10,d*=f}1>d&&(d=1)}e.tickSize=a.tickSize||[d,p];var m=e.tickSize[0];p=e.tickSize[1];var v=m*o[p];"second"==p?n.setSeconds(t(n.getSeconds(),m)):"minute"==p?n.setMinutes(t(n.getMinutes(),m)):"hour"==p?n.setHours(t(n.getHours(),m)):"month"==p?n.setMonth(t(n.getMonth(),m)):"quarter"==p?n.setMonth(3*t(n.getMonth()/3,m)):"year"==p&&n.setFullYear(t(n.getFullYear(),m)),n.setMilliseconds(0),v>=o.minute&&n.setSeconds(0),v>=o.hour&&n.setMinutes(0),v>=o.day&&n.setHours(0),v>=4*o.day&&n.setDate(1),v>=2*o.month&&n.setMonth(t(n.getMonth(),3)),v>=2*o.quarter&&n.setMonth(t(n.getMonth(),6)),v>=o.year&&n.setMonth(0);var b,y=0,x=Number.NaN;do if(b=x,x=n.getTime(),i.push(x),"month"==p||"quarter"==p)if(1>m){n.setDate(1);var _=n.getTime();n.setMonth(n.getMonth()+("quarter"==p?3:1));var w=n.getTime();n.setTime(x+y*o.hour+(w-_)*m),y=n.getHours(),n.setHours(0)}else n.setMonth(n.getMonth()+m*("quarter"==p?3:1));else"year"==p?n.setFullYear(n.getFullYear()+m):n.setTime(x+v);while(x<e.max&&x!=b);return i},n.tickFormatter=function(e,t){var n=s(e,t.options);if(null!=a.timeformat)return i(n,a.timeformat,a.monthNames,a.dayNames);var r,l=t.options.tickSize&&"quarter"==t.options.tickSize[1]||t.options.minTickSize&&"quarter"==t.options.minTickSize[1],c=t.tickSize[0]*o[t.tickSize[1]],h=t.max-t.min,u=a.twelveHourClock?" %p":"",d=a.twelveHourClock?"%I":"%H";r=c<o.minute?d+":%M:%S"+u:c<o.day?h<2*o.day?d+":%M"+u:"%b %d "+d+":%M"+u:c<o.month?"%b %d":l&&c<o.quarter||!l&&c<o.year?h<o.year?"%b":"%b %Y":l&&c<o.year?h<o.year?"Q%q":"Q%q %Y":"%Y";var p=i(n,r,a.monthNames,a.dayNames);return p})})})}var r={xaxis:{timezone:null,timeformat:null,twelveHourClock:!1,monthNames:null}},o={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,quarter:7776e6,year:1e3*525949.2*60},l=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"]],c=l.concat([[3,"month"],[6,"month"],[1,"year"]]),h=l.concat([[1,"quarter"],[2,"quarter"],[1,"year"]]);e.plot.plugins.push({init:a,options:r,name:"time",version:"1.0"}),e.plot.formatDate=i}(jQuery);